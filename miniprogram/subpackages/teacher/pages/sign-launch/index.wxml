<view class="page">
  <view class="card course-card" wx:if="{{courseInfo}}">
    <view class="title">{{courseName || '选择课程'}}</view>
    <view class="meta">班级：{{courseInfo.clazz}}</view>
    <view class="meta">上课时间：{{courseInfo.time}}</view>
    <view class="meta">学生人数：{{courseInfo.studentCount}}</view>
    <view class="location">签到地点：{{courseInfo.location}}</view>
    <button size="mini" bindtap="handleRelocate">重新定位</button>
  </view>

  <view class="card form-card">
    <view class="field">
      <view class="label">签到策略</view>
      <picker mode="selector" range="{{modes}}" value="{{modes.indexOf(form.mode)}}" bindchange="handleModeChange">
        <view class="picker">{{form.mode}}</view>
      </picker>
      <view class="hint">
        {{
          form.mode === '高安全模式'
            ? '定位+二维码+人脸，多重验证'
            : form.mode === '便捷模式'
            ? '仅二维码，适合小班研讨'
            : '定位+二维码'
        }}
      </view>
    </view>
    <view class="field">
      <view class="label">签到时长（分钟）</view>
      <slider min="5" max="30" step="1" value="{{form.duration}}" data-field="duration" bindchange="handleSliderChange" />
      <view class="value">{{form.duration}} 分钟（建议 5-15 分钟）</view>
    </view>
    <view class="field">
      <view class="label">有效范围（米）</view>
      <slider min="30" max="200" step="5" value="{{form.range}}" data-field="range" bindchange="handleSliderChange" />
      <view class="value">范围 {{form.range}} 米</view>
    </view>
    <view class="field">
      <view class="label">迟到缓冲（分钟）</view>
      <slider min="0" max="15" step="5" value="{{form.lateBuffer}}" data-field="lateBuffer" bindchange="handleSliderChange" />
      <view class="value">允许迟到 {{form.lateBuffer}} 分钟</view>
    </view>
    <view class="field">
      <view class="label">二维码刷新（秒）</view>
      <slider
        min="10"
        max="60"
        step="5"
        value="{{form.qrRefreshInterval}}"
        data-field="qrRefreshInterval"
        bindchange="handleSliderChange"
      />
      <view class="value">{{form.qrRefreshInterval}} 秒自动刷新</view>
    </view>
    <view class="field">
      <view class="label">自动结束（分钟）</view>
      <slider
        min="5"
        max="60"
        step="5"
        value="{{form.autoCloseMinutes}}"
        data-field="autoCloseMinutes"
        bindchange="handleSliderChange"
      />
      <view class="value">{{form.autoCloseMinutes}} 分钟后自动关闭</view>
    </view>
    <view class="field">
      <view class="label">补充说明</view>
      <textarea
        placeholder="可选，如考试或特殊安排说明"
        value="{{form.remark}}"
        data-field="remark"
        bindinput="handleInput"
      />
    </view>
    <button type="primary" loading="{{submitting}}" bindtap="handleSubmit">开始签到</button>
  </view>
</view>
